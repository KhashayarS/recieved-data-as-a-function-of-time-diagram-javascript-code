var dy,axis_t_vals_pi,axis_y_vals_pi,next_step_t,next_step_y,shrinked_time_step,shrinked_y_step,t_values_pi,y_values_pi,len,theta,theta_last,theta_dc,theta_last_dc,time_interval,time_interval0,diagram_color="#0FF271",diagram_path=document.querySelector("#diagram_path"),diagram_background=document.querySelector("#diagram_background"),arrow_tip=document.querySelector("#arrow_tip"),diagram_path_=document.querySelector("#diagram_path_"),diagram_background_=document.querySelector("#diagram_background_"),arrow_tip_dc=document.querySelector("#arrow_tip_dc"),t_values=document.querySelector("#t_values"),y_values=document.querySelector("#y_values"),value_illustrator=document.querySelector("#value_illustrator"),value_text=document.querySelector("#value_text"),value_text_background=document.querySelector("#value_text_background"),svg_el=document.querySelector("svg"),coords_axis=document.querySelector("#coords_axis"),start_btn=document.querySelector("#start-btn"),pause_btn=document.querySelector("#pause-btn"),stop_btn=document.querySelector("#stop-btn"),reset_btn=document.querySelector("#reset-btn"),color_btn=document.querySelector("#change-color"),bg_color_btn=document.querySelector("#change-bg-color"),maximum=2.1,t_stored=[],t_min_pi=50,t_max_pi=950,time_increment_initial=95,t_range_pi=t_max_pi-t_min_pi,y=1,y_stored=[],y_max_pi=400,y_min_pi=50,y_range_pi=y_max_pi-y_min_pi,diag_ratio=y_range_pi/t_range_pi,t0=0,t1=0,t=0,dt=.01,record_time=5,first_round=!0,rounded_time_last=0,default_time_step=10,shrinked_range_t=t_range_pi,number_t_steps=[9.5,9.51],shrinkage_rate=number_t_steps[0]/number_t_steps[1],shrinkage_magnitude=shrinked_range_t*(1-shrinkage_rate),k=0,max_number_points=500,points_index=[],arrow_height=50,arrow_width=40,arrow_backward=30,arrow_counter=0,arrow_counter_dc=0,run_allowable=!0,running=!1,connected=!0,interruption_time=-1,values_conotroller=function(){var e=function(e){var r;if(t_values_pi=[],points_index=[],t<=9.5)e.forEach(function(t){r=t/9.5*t_range_pi+t_min_pi,t_values_pi.push(r)});else{len=e.length;for(var n=Math.ceil(len/max_number_points),_=0;_<len;_+=n)points_index.push(_);!1===points_index.includes(len-1)&&points_index.push(len-1),points_index.forEach(function(n){r=e[n]/t*t_range_pi+t_min_pi,t_values_pi.push(r)})}return t_values_pi},r=function(e){var r;return y_values_pi=[],t<=9.5?e.forEach(function(t){r=y<=2?y_max_pi-(t-1)*y_range_pi:y_max_pi-(t-1)*y_range_pi/(y-1),y_values_pi.push(r)}):points_index.forEach(function(t){r=y<=2?y_max_pi-(e[t]-1)*y_range_pi:y_max_pi-(e[t]-1)*y_range_pi/(y-1),y_values_pi.push(r)}),y_values_pi};return{time_elapse:function(t,e){return t+e},t_axis_values_pixel:function(e){return function(e){if(t<=9.5)for(axis_t_vals_pi=[],next_step_t=t_min_pi+time_increment_initial;next_step_t<t_max_pi;)axis_t_vals_pi.push(next_step_t),next_step_t+=time_increment_initial;else{var r=[];for(shrinked_time_step=t_range_pi/number_t_steps[k+1],next_step_t=t_min_pi+shrinked_time_step;next_step_t<=t_max_pi;next_step_t+=shrinked_time_step)r.push(next_step_t);number_t_steps.push(number_t_steps[k+1]+dt),k++,axis_t_vals_pi=r}return axis_t_vals_pi}()},y_axis_values_pixel:function(t){return function(t){if(dy=t-2,t<=2)(axis_y_vals_pi=[]).push(y_max_pi-.5*y_range_pi);else{var e=[];for(next_step_y=y_max_pi-(shrinked_y_step=y_range_pi/(dy+1));next_step_y>=y_min_pi;next_step_y-=shrinked_y_step)e.push(next_step_y);axis_y_vals_pi=e}return axis_y_vals_pi}(t)},y_value_raise:function(t){return(e=t)>y&&(y=e),y;var e},store_t_data:function(t){return function(t){t_stored.push(t)}(t)},store_y_data:function(t){return y_stored.push(y),y_stored},data_t_y:function(t){return{data_t:e(t_stored),data_y:r(y_stored)}},reset_data:function(){t_stored=[],t=0,k=0,points_index=[],arrow_counter=0,y=1,y_stored=[],running=!1,connected=!0,interruption_time=-1},get_interruption_time:function(){return connected&&t>0&&(interruption_time=t,connected=!1),interruption_time},interruption_vals_arr:function(){return function(){var t=[],n=[];t_stored.forEach(function(e){e<=interruption_time&&t.push(e)});for(var _=0;_<t.length;_++)n.push(y_stored[_]);return{data_t_dc:e(t),data_y_dc:r(n)}}()},start_timer_record:function(){record_time-=.1}}}(),ui_controller=function(){var e=function(e,r){tn_el='<line x1="'+e.toString()+'" y1="400" x2="'+e.toString()+'" y2="395" stroke-width="2"/>"',text_el='<text transform="matrix(1 0 0 1 '+(e-5).toString()+' 420)" font-family="\'TimesNewRomanPSMT\'" font-size="12">'+r.toString()+"s</text>",e<=t_max_pi&&(t<=15?(t_values.insertAdjacentHTML("beforeend",tn_el),t_values.insertAdjacentHTML("beforeend",text_el)):t<=30&&r%2==0?(t_values.insertAdjacentHTML("beforeend",tn_el),t_values.insertAdjacentHTML("beforeend",text_el)):t>30&&r%10==0&&(t_values.insertAdjacentHTML("beforeend",tn_el),t_values.insertAdjacentHTML("beforeend",text_el)))},r=function(t,e){yn_el='<line x1="50" y1="'+t.toString()+'" x2="950" y2="'+t.toString()+'" stroke-width="2"/>',text_el_y='<text transform="matrix(1 0 0 1 10 '+(t+3).toString()+')" font-family="\'TimesNewRomanPSMT\'" font-size="12">'+parseFloat(e).toFixed(1)+"X</text>",y<=6?(y_values.insertAdjacentHTML("beforeend",yn_el),y_values.insertAdjacentHTML("beforeend",text_el_y)):y<=30&&e%2==0?(y_values.insertAdjacentHTML("beforeend",yn_el),y_values.insertAdjacentHTML("beforeend",text_el_y)):y<120&&e%10==0?(y_values.insertAdjacentHTML("beforeend",yn_el),y_values.insertAdjacentHTML("beforeend",text_el_y)):y<250&&e%20==0?(y_values.insertAdjacentHTML("beforeend",yn_el),y_values.insertAdjacentHTML("beforeend",text_el_y)):e%100==0&&(y_values.insertAdjacentHTML("beforeend",yn_el),y_values.insertAdjacentHTML("beforeend",text_el_y))};function n(){value_illustrator.innerHTML=""}var _=function(t,e,r=!1){for(var n="M50 400",_='<text id="value_text" text-anchor="middle" alignment-baseline="middle" transform="matrix(1 0 0 1 500 200)" font-family="\'TimesNewRomanPSMT\'" font-size="50" fill=" '+diagram_color+'">'+parseFloat(y).toFixed(2)+"x</text>",a=0;a<t.length;a++)n+=" L "+t[a].toString()+" "+e[a].toString();var i=n+" V 400 Z";r?r&&(diagram_background_dc.setAttribute("d",i),diagram_path_dc.setAttribute("d",n)):(diagram_background.setAttribute("d",i),diagram_path.setAttribute("d",n));var o,s,u,l,c,d,m,p,v,h,f=t.length;r?r&&f>=6&&(v=(e[f-5]-e[f-6])/(t[f-6]-t[f-5]),theta_dc=Math.atan(v),Math.abs(theta_dc-theta_last_dc)>=.25&&arrow_counter_dc<=10?(theta_dc=Math.max(theta_dc,theta_last_dc),arrow_counter_dc+=1):arrow_counter_dc=0,o=arrow_backward*Math.cos(theta_dc),s=arrow_backward*Math.sin(theta_dc),u=t[f-1]-arrow_width/2*Math.sin(theta_dc)-o,l=e[f-1]-arrow_width/2*Math.cos(theta_dc)+s,c=t[f-1]+arrow_width/2*Math.sin(theta_dc)-o,d=e[f-1]+arrow_width/2*Math.cos(theta_dc)+s,m=t[f-1]+arrow_height*Math.cos(theta_dc)-o,p=e[f-1]-arrow_height*Math.sin(theta_dc)+s,h=u.toString()+","+l.toString()+" "+c.toString()+","+d.toString()+" "+m.toString()+","+p.toString()+" ",arrow_tip_dc.setAttribute("points",h),theta_last_dc=theta_dc):f>=6&&(v=(e[f-5]-e[f-6])/(t[f-6]-t[f-5]),theta=Math.atan(v),Math.abs(theta-theta_last)>=.25&&arrow_counter<=10?(theta=Math.max(theta,theta_last),arrow_counter+=1):arrow_counter=0,o=arrow_backward*Math.cos(theta),s=arrow_backward*Math.sin(theta),u=t[f-1]-arrow_width/2*Math.sin(theta)-o,l=e[f-1]-arrow_width/2*Math.cos(theta)+s,c=t[f-1]+arrow_width/2*Math.sin(theta)-o,d=e[f-1]+arrow_width/2*Math.cos(theta)+s,m=t[f-1]+arrow_height*Math.cos(theta)-o,p=e[f-1]-arrow_height*Math.sin(theta)+s,h=u.toString()+","+l.toString()+" "+c.toString()+","+d.toString()+" "+m.toString()+","+p.toString()+" ",arrow_tip.setAttribute("points",h),theta_last=theta),value_illustrator.innerHTML="",value_illustrator.insertAdjacentHTML("beforeend",'<rect id="value_text_background" x="400" y="160" width="200" height="80" fill="#0000004D"/>'),value_illustrator.insertAdjacentHTML("beforeend",_)};return{t_value_adder:function(t,r){return e(t,r)},y_value_adder:function(t,e){return r(t,e)},t_value_remover:function(){t_values.innerHTML=""},y_value_remover:function(){y_values.innerHTML=""},value_text_remover:function(){return n()},changeColor:function(t){t=t.toString(),diagram_color=t,diagram_background.setAttribute("fill",t+"80"),diagram_path.setAttribute("stroke",t),arrow_tip.setAttribute("fill",t)},display_record_timer:function(t){var e;e='<text id="timer_text_value" text-anchor="middle" alignment-baseline="middle" transform="matrix(1 0 0 1 500 200)" font-family="\'TimesNewRomanPSMT\'" font-size="30" fill="#FFFFFF">Next round in '+parseFloat(t).toFixed(1)+"s</text>",n(),value_illustrator.insertAdjacentHTML("afterbegin",e)},draw_diagram:function(t,e,r){_(t,e,r)},reset_ui:function(){_([],[],!1),_([],[],!0),arrow_tip.setAttribute("points","50,400 50,400 50,400"),arrow_tip_dc.setAttribute("points","50,400 50,400 50,400"),n()}}}(),controller=function(e,r){var n,_=function(t){var n=e.t_axis_values_pixel(t);r.t_value_remover();var _=1;n.forEach(function(t){r.t_value_adder(t,_),_++})},a=function(t){var n=e.y_axis_values_pixel(t);r.y_value_remover();var _=2;t<=2?r.y_value_adder(225,1.5):n.forEach(function(t){r.y_value_adder(t,_),_++})},i=function(){e.get_interruption_time(),interruption_time>0&&(n=e.interruption_vals_arr(),r.draw_diagram(n.data_t_dc,n.data_y_dc,!0))},o=function(){var n=e.data_t_y();t=e.time_elapse(t,dt),e.store_t_data(t),e.store_y_data(t),y>1&&(r.draw_diagram(n.data_t,n.data_y,!1),r.changeColor(diagram_color)),interruption_time>0&&i(),_(t),a(y)};return{run_time:function(){running||(time_interval0=setInterval(function(){record_time>0?(r.display_record_timer(record_time),e.start_timer_record()):record_time<=0&&r.value_text_remover()},100),first_round?setTimeout(function(){time_interval=setInterval(function(){o()},10)},5e3):first_round||(time_interval=setInterval(function(){o()},10)),first_round=!1,running=!0)},raise_X:function(t){t>y&&t>1&&(y=t)},time_axis_modification:function(){_(t)},y_axis_modification:function(){a(y)},changeColor:function(t){var e,n;-1===(n=(e=["#0FF271","#FFFF00","#00FF00","#0000FF"]).indexOf(diagram_color))||3===n?r.changeColor(e[0]):r.changeColor(e[n+1])},stop:function(){clearInterval(time_interval),clearInterval(time_interval0),running=!1},reset:function(){clearInterval(time_interval),clearInterval(time_interval0),e.reset_data(),r.reset_ui(),_(t),a(y),record_time=5},user_interruption:function(){return i()}}}(values_conotroller,ui_controller);function runTime(){controller.run_time(),controller.time_axis_modification(),controller.y_axis_modification()}function raise(){var t=1;inerval1=setInterval(function(){t+=.01,controller.raise_X(t)},10)}function raise2(){var t=1;inerval2=setInterval(function(){t*=1.001,controller.raise_X(t)},10)}start_btn.addEventListener("click",function(){run_allowable=!0,controller.run_time()}),stop_btn.addEventListener("click",function(){controller.stop(),run_allowable=!1}),color_btn.addEventListener("click",function(){controller.changeColor()}),reset_btn.addEventListener("click",function(){controller.reset()}),bg_color_btn.addEventListener("click",function(){var t=["rgb(21, 32, 35)","rgb(0, 255, 255)"],e=["rgb(255, 255, 255)","rgb(0, 0, 0)"];svg_el.style.backgroundColor===t[0]?(svg_el.style.backgroundColor=t[1],coords_axis.setAttribute("stroke",e[1]),t_values.setAttribute("stroke",e[1]),y_values.setAttribute("stroke",e[1])):(svg_el.style.backgroundColor=t[0],coords_axis.setAttribute("stroke",e[0]),t_values.setAttribute("stroke",e[0]),y_values.setAttribute("stroke",e[0]))}),pause_btn.addEventListener("click",function(){controller.user_interruption()});